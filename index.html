<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>SQLServerEjemplos</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="./style.css" rel="stylesheet" />
  </head>

  <body>
    <div class="container-fluid">
      <div class="row">
        <nav class="col-md-3 col-lg-2 d-md-block sidebar">
          <div class="sidebar-sticky">
            <div class="sidebar-content">
              <ul class="nav flex-column">
                <li class="nav-item">
                  <a class="nav-link" href="#introduccion"> Introducción </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link active" href="#ejemplo1">
                    Recuperación de datos básica
                  </a>
                </li>

                <li class="nav-item">
                  <a class="nav-link" href="#ejemplo2"> Filtrado de datos </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#ejemplo3"> Consultas agrupadas </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#ejemplo4"> Tablas temporales </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#ejemplo5">
                    Procedimientos almacenados
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#ejemplo6">
                    Creación y modificación de tablas
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
          <section class="encabezado" id="introduccion">
            <h1>EJEMPLOS DE SQL SERVER</h1>
            <br />
            <p>
              Aquí podrán ver una serie de ejemplos utilizando la base de datos
              <a
                href="https://learn.microsoft.com/en-us/sql/samples/adventureworks-install-configure?view=sql-server-ver16&tabs=ssms"
                target="blank"
                >"AdventureWorks"</a
              >
              creada por Microsoft para demostración de SQL Server. Esta base de
              datos almacena información de una empresa dedicada a la venta de
              bicicletas y artículos para ciclismo.
            </p>
            <p>
              <strong>Importante: </strong>No será necesario descargar la base
              de datos. Todos los ejemplos se pueden probar haciendo click en el
              botón "Playground", donde se mostrará la consulta y su resultado
              en una base de datos disponible online.
            </p>

            <p>
              En los ejemplos utilizaremos las tablas relacionadas a órdenes de
              compras (<code>SalesOrderHeader</code> y
              <code>SalesOrderDetail</code>), productos (<code>Product</code>) y
              clientes (<code>Customer</code>). Estos últimos podrán ser
              personas físicas o negocios (<code>Person</code> y
              <code>Store</code>).
            </p>
            <p>
              El siguiente es un diagrama simplificado de la base de datos
              AdventureWorks con las tablas que utilizaremos.
            </p>
            <div style="overflow: hidden">
              <img
                src="./imagenes/AdventureWorksDiagram.png"
                style="width: 100%"
              />
            </div>
          </section>
          <br />
          <div id="ejemplo1" class="my-4 contenedor-ejemplo">
            <section class="section" id="ejemplo1">
              <h2>Recuperación de datos básica</h2>
              <p>
                SELECT es esencial para recuperar y manipular datos almacenados
                en una base de datos, permitiendo a los desarrolladores y
                administradores realizar consultas personalizadas para obtener
                la información que necesitan.
              </p>
            </section>
            <br />
            <h4>SELECT INNER JOIN</h4>
            <p>
              Se utiliza INNER JOIN cuando queremos recuperar datos que tienen
              relaciones definidas entre dos o más tablas. Se seleccionan sólo
              las filas que tienen valores coincidentes en ambas tablas.
            </p>
            <p>
              <strong>Ejemplo:</strong> Obtener las órdenes de venta para una
              fecha dada, mostrando los datos del cliente.
            </p>

            <div class="codigo-fuente">
              <pre>

        <span class="sql-statement">SELECT </span> S.SalesOrderID, S.CustomerID, P.FirstName, P.LastName, P.MiddleName,
                S.OrderDate, S.SalesOrderNumber, S.TotalDue
        <span class="sql-statement">FROM</span> Sales.SalesOrderHeader S
            <span class="sql-operator">INNER JOIN</span> Sales.Customer C ON S.CustomerID = C.CustomerID
            <span class="sql-operator">INNER JOIN</span> Person.Person P ON C.PersonID = P.BusinessEntityID
        <span class="sql-statement">WHERE</span> S.OrderDate = <span class="sql-string">'2011-05-31' </span>
        <span class="sql-statement">ORDER BY</span> S.SalesOrderID
                        </pre>
            </div>

            <button type="button" class="btn btn-light">
              <a
                href="https://dbfiddle.uk/_YbppGDv"
                target="_blank"
                style="text-decoration: none; color: inherit"
                >Ver en Playground</a
              >
            </button>
            <div id="ejemplo1" class="my-4">
              <h4>SELECT TOP</h4>
              <p>
                Se usa para seleccionar las primeras N filas de un conjunto de
                resultados. Esto puede ser útil cuando sólo estás interesado en
                ver una cantidad limitada de datos.
              </p>
              <p>
                <strong>Ejemplo:</strong> Obtener el Top 10 de Productos más
                vendidos en el año 2012
              </p>

              <div class="codigo-fuente">
                <pre>
    
        <span class="sql-statement">SELECT TOP</span> 10 P.ProductID, P.Name <span class="sql-statement">AS</span> ProductName, <span class="sql-function">SUM</span>(D.OrderQty) <span class="sql-statement">AS</span> ProductQuantity        
        <span class="sql-statement">FROM</span> Sales.SalesOrderDetail D
            <span class="sql-operator">INNER JOIN</span> Sales.SalesOrderHeader H <span class="sql-statement">ON</span> D.SalesOrderID = H.SalesOrderID
            <span class="sql-operator">INNER JOIN</span> Production.Product P <span class="sql-statement">ON</span> D.ProductID = P.ProductID
        <span class="sql-statement">WHERE</span> H.OrderDate <span class="sql-operator">BETWEEN</span> <span class="sql-string">'2012-01-01'</span> <span class="sql-operator">AND</span> <span class="sql-string">'2012-12-31'</span>
        <span class="sql-statement">GROUP BY</span> P.ProductID, P.Name 
        <span class="sql-statement">ORDER BY</span> ProductQuantity <span class="sql-statement">DESC</span>
                
    </pre>
              </div>
              <button type="button" class="btn btn-light">
                <a
                  href="https://dbfiddle.uk/Kjx4W9Bj"
                  target="_blank"
                  style="text-decoration: none; color: inherit"
                  >Ver en Playground</a
                >
              </button>
            </div>

            <div id="ejemplo1" class="my-4">
              <h4>SELECT LEFT JOIN</h4>
              <p>
                Devuelve todas las filas de la tabla izquierda y las filas
                coincidentes de la tabla derecha. Si no hay coincidencias en la
                tabla derecha, devuelve valores NULL en las columnas
                seleccionadas de la tabla derecha
              </p>
              <p>
                <strong>Ejemplo:</strong> Obtener datos de los clientes. Los
                clientes pueden ser personas físicas o negocios. Para los
                clientes de tipo persona utilizaremos la concatenación de
                apellido y nombre. Para los clientes de tipo negocio,
                mostraremos el nombre correspondiente.
              </p>

              <div class="codigo-fuente">
                <pre>

        <span class="sql-statement">SELECT</span> C.CustomerID, C.PersonID, C.StoreID, 
            <span class="sql-statement">CASE WHEN</span> C.PersonID <span class="sql-operator">IS NOT NULL</span> <span class="sql-statement">THEN</span><span class="sql-string"> 'Person' </span><span class="sql-statement">ELSE</span> <span class="sql-string">'Store'</span> <span class="sql-statement">END AS</span> CustomerType,
            <span class="sql-statement">CASE WHEN</span> C.PersonID <span class="sql-operator">IS NOT NULL</span> <span class="sql-statement">THEN</span> Per.LastName +  <span class="sql-string">', '</span> + Per.FirstName <span class="sql-statement">ELSE</span> S.Name <span class="sql-statement">END AS</span> CustomerName	
        <span class="sql-statement">FROM</span> Sales.Customer C
            <span class="sql-operator">LEFT JOIN</span> Person.Person Per <span class="sql-statement">ON</span> C.PersonID = Per.BusinessEntityID
            <span class="sql-operator">LEFT JOIN</span> Sales.Store S <span class="sql-statement">ON</span> C.StoreID = S.BusinessEntityID
        <span class="sql-statement">WHERE</span> C.CustomerID <span class="sql-operator">BETWEEN</span> 697 <span class="sql-operator">AND</span> 11010 
                        </pre>
              </div>
              <button type="button" class="btn btn-light">
                <a
                  href="https://dbfiddle.uk/N0HFs02P"
                  target="_blank"
                  style="text-decoration: none; color: inherit"
                  >Ver en Playground</a
                >
              </button>
            </div>
            <div id="ejemplo1" class="my-4">
              <h4>SELECT UNION</h4>
              <p>
                Se utiliza para combinar los resultados de dos o más consultas
                en una sola lista de resultados. La función principal de UNION
                es eliminar duplicados y fusionar las filas de resultados de
                múltiples consultas en una única lista de resultados.
              </p>
              <p>
                <strong>Ejemplo: </strong> Obtener los datos de una serie de
                clientes, si es persona nombre y apellido, si no lo es, nombre
                de la empresa. Ejemplo muy parecido al anterior pero las
                consultas se hacen por separado
              </p>
              <div class="codigo-fuente">
                <pre>

        <span class="sql-statement">SELECT</span> C.CustomerID, C.PersonID, C.StoreID, 	
            Per.LastName +  ', ' + Per.FirstName <span class="sql-statement">AS</span> CustomerName,
            <span class="sql-string">'Person'</span> <span class="sql-statement">AS</span> CustomerType
        <span class="sql-statement">FROM</span> Sales.Customer C
            <span class="sql-statement">INNER JOIN</span> Person.Person Per <span class="sql-statement">ON</span> C.PersonID = Per.BusinessEntityID            
        <span class="sql-statement">WHERE</span> C.CustomerID <span class="sql-operator">BETWEEN</span> 697 <span class="sql-operator">AND</span> 11010 
        <span class="sql-statement">UNION</span>
        <span class="sql-statement">SELECT</span> C.CustomerID, C.PersonID, C.StoreID, 
            S.Name as CustomerName,
            <span class="sql-string">'Store'</span> <span class="sql-statement">AS</span> CustomerType
        <span class="sql-statement">FROM</span> Sales.Customer C            
            <span class="sql-statement">INNER JOIN</span> Sales.Store S <span class="sql-statement">ON</span> C.StoreID = S.BusinessEntityID
        <span class="sql-statement">WHERE</span> C.CustomerID <span class="sql-operator">BETWEEN</span> 697 <span class="sql-operator">AND</span> 11010 
                        </pre>
              </div>
              <button type="button" class="btn btn-light">
                <a
                  href="https://dbfiddle.uk/kd6nxevN"
                  target="_blank"
                  style="text-decoration: none; color: inherit"
                  >Ver en Playground</a
                >
              </button>
            </div>
          </div>
          <div id="ejemplo2" class="my-4 contenedor-ejemplo">
            <section class="section" id="ejemplo2">
              <h2>Filtrado de datos (WHERE)</h2>
              <p>
                La cláusula WHERE es esencial para limitar los resultados de una
                consulta a las filas que cumplen con ciertos criterios,
                permitiéndote extraer información específica de tu base de
                datos.
              </p>
            </section>

            <div id="ejemplo2" class="my-4">
              <h4>WHERE filtrando por YEAR</h4>
              <p>
                La función YEAR() se utiliza para extraer el año de una fecha
                específica. Se puede utilizar esta función con WHERE para
                filtrar las filas de una tabla basadas en el año de una columna
                de tipo fecha.
              </p>
              <p>
                <strong>Ejemplo:</strong> Obtener el top 10 de las ordenes de
                compra en el año 2013 con mayores ventas.
              </p>
              <div class="codigo-fuente">
                <pre>

        <span class="sql-statement">SELECT TOP</span> 10 *  
        <span class="sql-statement">FROM</span>  Sales.SalesOrderHeader O
        <span class="sql-statement">WHERE</span> 
            <span class="sql-function">YEAR</span>(OrderDate) = 2013
        <span class="sql-statement">ORDER BY</span> TotalDue <span class="sql-statement">DESC</span>
                            </pre>
              </div>
              <button type="button" class="btn btn-light">
                <a
                  href="https://dbfiddle.uk/OMzOkwij"
                  target="_blank"
                  style="text-decoration: none; color: inherit"
                  >Ver en Playground</a
                >
              </button>
            </div>
            <div id="ejemplo2" class="my-4">
              <h4>WHERE filtrando por MONTH</h4>
              <p>
                Se utiliza para extraer el componente del mes de una fecha dada.
                Esta función toma una fecha como entrada y devuelve el número de
                mes correspondiente (un valor entero entre 1 y 12).
              </p>
              <p>
                <strong>Ejemplo:</strong> Obtener el top 5 de las ordenes de
                compra en el año 2013 del mes 8 con mayores ventas.
              </p>
              <div class="codigo-fuente">
                <pre>

        <span class="sql-statement">SELECT TOP</span> 5 *  
        <span class="sql-statement">FROM</span>  Sales.SalesOrderHeader O
        <span class="sql-statement">WHERE</span> 
           <span class="sql-function">YEAR</span>(OrderDate) = 2013
           <span class="sql-operator">AND</span> <span class="sql-function">MONTH</span>(OrderDate) = 8
        <span class="sql-statement">ORDER BY </span>TotalDue <span class="sql-statement">DESC</span>
                    </pre>
              </div>
              <button type="button" class="btn btn-light">
                <a
                  href="https://dbfiddle.uk/P3af19E4"
                  target="_blank"
                  style="text-decoration: none; color: inherit"
                  >Ver en Playground</a
                >
              </button>
            </div>
            <div id="ejemplo2" class="my-4">
              <h4>WHERE filtrando por BETWEEN</h4>
              <p>
                WHERE, cuando se combina con BETWEEN, se puede filtrar filas en
                función de un rango de valores.
              </p>
              <p>
                <strong>Ejemplo:</strong>
                Obtener todas las ordenes de compra del mes de enero del año
                2012
              </p>
              <div class="codigo-fuente">
                <pre>

        <span class="sql-statement">SELECT</span> *
        <span class="sql-statement">FROM</span> Sales.SalesOrderHeader S
        <span class="sql-statement">WHERE</span> S.OrderDate <span class="sql-operator">BETWEEN</span> <span class="sql-string">'2012-01-01'</span> <span class="sql-operator">AND</span> <span class="sql-string">'2012-01-31'</span>
                  </pre>
              </div>
              <button type="button" class="btn btn-light">
                <a
                  href="https://dbfiddle.uk/01EkAbFg"
                  target="_blank"
                  style="text-decoration: none; color: inherit"
                  >Ver en Playground</a
                >
              </button>
            </div>
            <div id="ejemplo2" class="my-4">
              <h4>WHERE filtrando por LIKE</h4>
              <p>
                La cláusula LIKE se utiliza para buscar patrones de texto en una
                columna. Puedes usar " % " como comodín para representar cero o
                más caracteres.
              </p>
              <p>
                <strong>Ejemplo:</strong>
                Obtener todos las personas cuyos nombres y apellidos comiencen
                con un patrón.
              </p>
              <div class="codigo-fuente">
                <pre>

        <span class="sql-statement">SELECT</span> *
        <span class="sql-statement">FROM</span> Person.Person
        <span class="sql-statement">WHERE</span> FirstName <span class="sql-operator">LIKE</span> <span class="sql-string">'Alex%'</span>
        <span class="sql-statement">AND</span> LastName <span class="sql-operator">LIKE</span> <span class="sql-string">'Mart%'</span>
                  </pre>
              </div>
              <button type="button" class="btn btn-light">
                <a
                  href="https://dbfiddle.uk/rHqPrZpG"
                  target="_blank"
                  style="text-decoration: none; color: inherit"
                  >Ver en Playground</a
                >
              </button>
            </div>
          </div>

          <div id="ejemplo3" class="my-4 contenedor-ejemplo">
            <section class="section" id="ejemplo3">
              <h2>Consultas agrupadas</h2>
              <p>
                Las consultas agrupadas son fundamentales para realizar análisis
                de datos y obtener estadísticas resumidas sobre conjuntos de
                datos en SQL Server. Se utilizan comúnmente en informes, paneles
                de control y otras aplicaciones de análisis de datos para
                resumir y visualizar información de manera significativa.
              </p>
            </section>

            <div id="ejemplo3" class="my-4">
              <h4>GROUP BY: COUNT(*)</h4>
              <p>
                La cláusula GROUP BY se utiliza para agrupar filas que tienen
                los mismos valores en una o más columnas en conjuntos separados.
                Luego, la función COUNT(*) se utiliza para contar el número de
                filas en cada grupo resultante.
              </p>
              <p>
                <strong>Ejemplo:</strong> Obtener cantidad de ordenes de compra
                por mes para un año dado.
              </p>

              <div class="codigo-fuente">
                <pre>

        <span class="sql-statement">SELECT</span> <span class="sql-function">YEAR</span>(S.OrderDate) <span class="sql-statement">AS</span> [Year], <span class="sql-function">MONTH</span>(S.OrderDate) <span class="sql-statement">AS</span> [Month], <span class="sql-function">COUNT</span><span class="sql-operator">(*)</span> <span class="sql-statement">AS</span> SalesOrdersCount
        <span class="sql-statement">FROM</span> Sales.SalesOrderHeader S
        <span class="sql-statement">WHERE</span> S.OrderDate <span class="sql-operator">BETWEEN</span> <span class="sql-string">'2012-01-01'</span> <span class="sql-operator">AND</span> <span class="sql-string">'2012-12-31'</span>
        <span class="sql-statement">GROUP BY</span> <span class="sql-function">YEAR</span>(S.OrderDate), <span class="sql-function">MONTH</span>(S.OrderDate) 
        <span class="sql-statement">ORDER BY</span> [Year], [Month]
                                </pre>
              </div>
              <button type="button" class="btn btn-light">
                <a
                  href="https://dbfiddle.uk/Oki_Ly9N"
                  target="_blank"
                  style="text-decoration: none; color: inherit"
                  >Ver en Playground</a
                >
              </button>
            </div>

            <div id="ejemplo3" class="my-4">
              <h4>Funciones MIN, MAX, SUM, COUNT, AVG</h4>
              <p>
                Son funciones de agregación que se utilizan comúnmente para
                realizar cálculos sobre conjuntos de datos en consultas SQL.
              </p>
              <p>
                <strong>MIN:</strong> Obtiene el valor mínimo de la columna para
                todo el conjunto de datos.
              </p>
              <p>
                <strong>MAX:</strong> Obtiene el valor máximo de la columna para
                todo el conjunto de datos.
              </p>
              <p>
                <strong>SUM:</strong> Obtiene la sumatoria de todos los valores
                de la columna para todo el conjunto de datos.
              </p>
              <p>
                <strong>COUNT:</strong> Contabiliza la cantidad de filas que
                fueron agrupadas.
              </p>
              <p>
                <strong>AVG:</strong> Obtiene el promedio de todos los valores
                de la columna para todo el conjunto de datos.
              </p>
              <p>
                <strong>Ejemplo:</strong> Obtener cantidad de ordenes de compra
                por mes en un mismo año, con las compras de mayor y menor
                importe, y el importe promedio.
              </p>

              <div class="codigo-fuente">
                <pre>

        <span class="sql-statement">SELECT</span> <span class="sql-funtion">YEAR</span>(S.OrderDate) <span class="sql-statement">AS</span> [Year], <span class="sql-funtion">MONTH</span>(S.OrderDate) <span class="sql-statement">AS</span> [Month], 
            <span class="sql-function">COUNT</span><span class="sql-operator">(*)</span> <span class="sql-statement">AS</span> SalesOrdersCount, 
            <span class="sql-function">SUM</span>(S.TotalDue) <span class="sql-statement">AS</span> TotalDue,
            <span class="sql-function">AVG</span>(S.TotalDue) <span class="sql-statement">AS</span> AvgTotalDue,
            <span class="sql-function">MIN</span>(S.TotalDue) <span class="sql-statement">AS</span> MinTotalDue,
            <span class="sql-function">MAX</span>(S.TotalDue) <span class="sql-statement">AS</span> MaxTotalDue
        <span class="sql-statement">FROM </span> Sales.SalesOrderHeader S
        <span class="sql-statement">WHERE</span> S.OrderDate <span class="sql-operator">BETWEEN</span> <span class="sql-string">'2012-01-01'</span> <span class="sql-operator">AND</span> <span class="sql-string">'2012-12-31'</span>
        <span class="sql-statement">GROUP BY</span> <span class="sql-function">YEAR</span>(S.OrderDate), <span class="sql-function">MONTH</span>(S.OrderDate) 
        <span class="sql-statement">ORDER BY</span> [Year], [Month]                                    
                                </pre>
              </div>
              <button type="button" class="btn btn-light">
                <a
                  href="https://dbfiddle.uk/OYf1yeZ9"
                  target="_blank"
                  style="text-decoration: none; color: inherit"
                  >Ver en Playground</a
                >
              </button>
            </div>
          </div>
          <div id="ejemplo4" class="my-4 contenedor-ejemplo">
            <section class="section" id="ejemplo4">
              <h2>Tablas temporales</h2>
              <p>
                Son tablas que existen temporalmente durante la ejecución de una
                sesión o un bloque de código en la base de datos. Estas tablas
                proporcionan un espacio de trabajo temporal donde se pueden
                almacenar datos temporales o intermedios para su posterior
                procesamiento, análisis o manipulación.
              </p>
            </section>

            <div id="ejemplo4" class="my-4">
              <h4>INTO #</h4>
              <p>
                La cláusula INTO # se utiliza en SQL Server para crear una tabla
                temporal dentro de una consulta SELECT y copiar los resultados
                de esa consulta en la tabla temporal recién creada. Esta
                cláusula es útil cuando deseas almacenar los resultados de una
                consulta en una tabla temporal para su posterior uso dentro de
                la misma sesión de la base de datos.
              </p>
              <p>
                <strong>Ejemplo:</strong>
                Obtener ventas mensuales para los Productos Top 10. Cada mes se
                muestra en una fila diferente.
              </p>
              <div class="codigo-fuente">
                <pre>

        <span class="sql-statement">SELECT TOP</span> 10 P.ProductID, p.Name <span class="sql-statement">AS</span> ProductName, SUM(D.OrderQty) as ProductQuantity
        <span class="sql-statement">INTO</span> #Top10  
        <span class="sql-statement">FROM</span> Sales.SalesOrderDetail D
            <span class="sql-operator">INNER JOIN</span> Sales.SalesOrderHeader H <span class="sql-statement">ON</span> D.SalesOrderID = H.SalesOrderID
            <span class="sql-operator">INNER JOIN</span> Production.Product P <span class="sql-statement">ON</span> D.ProductID = P.ProductID
        <span class="sql-statement">WHERE</span> H.OrderDate <span class="sql-operator">BETWEEN</span> <span class="sql-string">'2012-01-01'</span> <span class="sql-operator">AND</span> <span class="sql-string">'2012-12-31'</span>
        <span class="sql-statement">GROUP BY</span> P.ProductID, p.Name 
        <span class="sql-statement">ORDER BY</span> ProductQuantity <span class="sql-statement">DESC</span>


        <span class="sql-statement">SELECT</span> P.ProductID, P.ProductName, P.ProductQuantity, <span class="sql-function">MONTH</span>(H.OrderDate) as Month, <span class="sql-function">SUM</span>(D.OrderQty) <span class="sql-statement">AS</span> ProductQuantity
        <span class="sql-statement">FROM</span> Sales.SalesOrderDetail D
            <span class="sql-operator">INNER JOIN</span> Sales.SalesOrderHeader H on D.SalesOrderID = H.SalesOrderID
            <span class="sql-operator">INNER JOIN</span> #TOP10 P <span class="sql-operator">ON</span> D.ProductID = P.ProductID
        <span class="sql-statement">WHERE</span> H.OrderDate <span class="sql-operator">BETWEEN</span> <span class="sql-string">'2012-01-01'</span> <span class="sql-operator">AND</span> <span class="sql-string">'2012-12-31'</span>
        <span class="sql-statement">GROUP BY</span> P.ProductID, P.ProductName, P.ProductQuantity, <span class="sql-function">MONTH</span>(H.OrderDate)
        <span class="sql-statement">ORDER BY</span> 1,2,3,4

        <span class="sql-statement">DROP TABLE</span> #Top10
            
                                </pre>
              </div>
              <button type="button" class="btn btn-light">
                <a
                  href="https://dbfiddle.uk/92jqZ281"
                  target="_blank"
                  style="text-decoration: none; color: inherit"
                  >Ver en Playground</a
                >
              </button>
            </div>
          </div>

          <div id="ejemplo5" class="my-4 contenedor-ejemplo">
            <section class="section" id="ejemplo5">
              <h2>Procedimientos almacenados</h2>
              <p>
                Son conjuntos de instrucciones SQL que se almacenan en la base
                de datos del servidor. Estas instrucciones se agrupan
                lógicamente en un solo objeto y se pueden ejecutar repetidamente
                cuando sea necesario. Los procedimientos almacenados son útiles
                para realizar tareas repetitivas, procesos complejos, y
                operaciones que requieren múltiples pasos dentro de la base de
                datos.
              </p>
            </section>

            <div id="ejemplo5" class="my-4">
              <h4>CREATE PROCEDURE</h4>
              <p>
                Se utiliza para crear un procedimiento almacenado en la base de
                datos. Estos procedimientos son útiles para realizar tareas
                complejas, lógicas de negocios, o secuencias de comandos que se
                ejecutan con frecuencia.
              </p>
              <p>
                <strong>Ejemplo:</strong>
                Creamos un procedimiento almacenado para obtener las ventas
                mensuales para los diez producots más vendidos en un periodo.
                Cada mes se muestra en una fila diferente.
              </p>

              <div class="codigo-fuente">
                <pre>

        <span class="sql-statement">CREATE PROCEDURE</span> ObtenerVentasDeLosProductosMasVendidos 
            @FechaDesde	<span class="sql-statement">DATETIME</span>,
            @FechaHasta <span class="sql-statement">DATETIME</span>
        <span class="sql-statement">AS</span>

        <span class="sql-statement">SELECT TOP</span> 10 P.ProductID, p.Name <span class="sql-statement">AS</span> ProductName, <span class="sql-function">SUM</span>(D.OrderQty) <span class="sql-statement">AS</span> ProductQuantity
        <span class="sql-statement">INTO</span> #Top10  
        <span class="sql-statement">FROM</span> Sales.SalesOrderDetail D
            <span class="sql-operator">INNER JOIN</span> Sales.SalesOrderHeader H <span class="sql-statement">ON</span> D.SalesOrderID = H.SalesOrderID
            <span class="sql-operator">INNER JOIN</span> Production.Product P <span class="sql-statement">ON</span> D.ProductID = P.ProductID
        <span class="sql-statement">WHERE</span> H.OrderDate <span class="sql-operator">BETWEEN</span> @FechaDesde <span class="sql-operator">AND</span> @FechaHasta
        <span class="sql-statement">GROUP BY</span> P.ProductID, p.Name 
        <span class="sql-statement">ORDER BY</span> ProductQuantity <span class="sql-statement">DESC</span>


        <span class="sql-statement">SELECT</span> P.ProductID, P.ProductName, P.ProductQuantity, <span class="sql-function">MONTH</span>(H.OrderDate) <span class="sql-statement">AS</span> Month, <span class="sql-function">SUM</span>(D.OrderQty) <span class="sql-statement">AS</span> ProductQuantity
        <span class="sql-statement">FROM</span> Sales.SalesOrderDetail D
            <span class="sql-operator">INNER JOIN</span> Sales.SalesOrderHeader H <span class="sql-statement">ON</span> D.SalesOrderID = H.SalesOrderID
            <span class="sql-operator">INNER JOIN</span> #TOP10 P <span class="sql-statement">ON</span> D.ProductID = P.ProductID
        <span class="sql-statement">WHERE</span> H.OrderDate <span class="sql-operator">BETWEEN</span> @FechaDesde <span class="sql-operator">AND</span> @FechaHasta
        <span class="sql-statement">GROUP BY</span> P.ProductID, P.ProductName, P.ProductQuantity, <span class="sql-function">MONTH</span>(H.OrderDate)
        <span class="sql-statement">ORDER BY</span> 1,2,3,4

        <span class="sql-statement">DROP TABLE</span> #Top10 
              </pre>
              </div>
              <button type="button" class="btn btn-light">
                <a
                  href="https://dbfiddle.uk/Qz3GmpnZ"
                  target="_blank"
                  style="text-decoration: none; color: inherit"
                  >Ver en Playground</a
                >
              </button>
            </div>
            <div id="ejemplo5" class="my-4">
              <h4>EXEC</h4>
              <p>
                Se utiliza para ejecutar un procedimiento almacenado en SQL
                Server. Puedes utilizar EXEC seguido del nombre del
                procedimiento almacenado y cualquier parámetro que necesite el
                procedimiento.
              </p>
              <p>
                <strong>Ejemplo:</strong>
                Ejecutar el procedimiento almacenado creado en el ejemplo
                anterior
              </p>
              <div class="codigo-fuente">
                <pre>
                    
        <span class="sql-information">-- Ejecutar el procedimiento almacenado, pasando los valores de los parámetros</span>
        <span class="sql-statement">EXEC</span> ObtenerVentasDeLosProductosMasVendidos <span class="sql-string">'2012-01-01'</span>, <span class="sql-string">'2012-12-31'</span>     
                  </pre>
              </div>
            </div>
            <div id="ejemplo5" class="my-4">
              <h4>SP_HELPTEXT</h4>
              <p>
                SP_HELPTEXT es un procedimiento almacenado provisto por SQL
                Server que nos permite recuperar el código fuente de un
                procedimiento almacenado para poder revisarlo o luego editarlo.
              </p>
              <p>
                <strong>Ejemplo:</strong> Recuperar el código fuente del
                procedimiento almacenado
                "HumanResources.uspUpdateEmployeeHireInfo"
              </p>

              <div class="codigo-fuente">
                <pre>
                    
        <span class="sql-information"> -- Recuperar el código de un procedimiento almacenado</span>
        <span class="sql-statement">EXEC</span> sp_helptext [HumanResources.uspUpdateEmployeeHireInfo]
                  </pre>
              </div>
            </div>
          </div>
          <div id="ejemplo6" class="my-4 contenedor-ejemplo">
            <section class="section" id="ejemplo6">
              <h2>Creación y modificación de tablas</h2>
              <p>
                La creación y modificación de tablas sirve para diseñar y
                definir la estructura de las bases de datos, lo que permite
                almacenar, organizar y gestionar datos de manera eficiente.
              </p>
              <p>
                <strong
                  >Estas instrucciones son especialmente importantes cuando
                  queremos trasladar los cambios de la base de datos de un
                  ambiente a otro.</strong
                >
                Por ejemplo, cuando terminamos una tarea en nuestro ambiente de
                desarrollo, debemos proveer scripts de BD para actualizar la
                base de datos en el ambiente de Testing/QA, y luego el ambiente
                de Producción.
              </p>
            </section>

            <div id="ejemplo6" class="my-4">
              <h4>CREATE TABLE</h4>
              <p>
                Se utiliza para crear una nueva tabla en una base de datos. Esta
                instrucción es fundamental en el diseño y la estructuración de
                bases de datos relacionales, ya que define la estructura y el
                esquema de la tabla, incluidas las columnas y las restricciones.
              </p>
              <p>
                <strong>Ejemplo:</strong>
                Crear la tabla "Personas" siempre y cuando no exista previamente
              </p>
              <div class="codigo-fuente">
                <pre>

        <span class="sql-statement">IF</span> <span class="sql-operator">NOT EXISTS</span> (<span class="sql-statement">SELECT TOP</span> 1 1 <span class="sql-statement">FROM</span> <span class="sql-information">INFORMATION_SCHEMA.TABLES</span> <span class="sql-statement">WHERE</span> TABLE_NAME = <span class="sql-string">'Personas'</span> <span class="sql-operator">AND</span> TABLE_SCHEMA = <span class="sql-string">'dbo'</span>) 
        <span class="sql-statement">BEGIN</span>   
            <span class="sql-statement">CREATE TABLE</span> [dbo].[Personas](
                    [Id] [int] <span class="sql-statement">IDENTITY</span>(1,1) <span class="sql-operator">NOT NULL,</span>
                    [Nombre] [varchar](50) <span class="sql-operator">NOT NULL,</span>
                    [Apellido] [varchar](50) <span class="sql-operator">NOT NULL,</span>
                    [Documento] [int] <span class="sql-operator">NOT NULL,</span>
                    [FechaNacimieto] [datetime] <span class="sql-operator">NULL,</span>
                    [Sexo] [varchar](1) <span class="sql-operator">NOT NULL,</span>
                    [Estado] [bit] <span class="sql-operator">NOT NULL,</span>
                    [FechaAlta] [datetime] <span class="sql-operator">NOT NULL,</span>
                    [IdUsuarioAlta] [int] <span class="sql-operator">NOT NULL,</span>
                    [FechaModificacion] [datetime] <span class="sql-operator">NULL,</span>
                    [IdUsuarioModificacion] [int] <span class="sql-operator">NULL,</span>
                    [FechaBaja] [datetime] <span class="sql-operator">NULL,</span>
                    [IdUsuarioBaja] [int] <span class="sql-operator">NULL,</span>
                    <span class="sql-statement">CONSTRAINT</span> [PK_Personas] <span class="sql-statement">PRIMARY KEY CLUSTERED</span> ([Id] <span class="sql-statement">ASC</span>))
            
            <span class="sql-statement">ALTER TABLE</span> [dbo].[Personas] <span class="sql-statement">ADD  CONSTRAINT</span> [DF_Personas_Estado]  <span class="sql-statement">DEFAULT</span> ((1)) <span class="sql-statement">FOR</span> [Estado]
            
            <span class="sql-statement">ALTER TABLE</span> [dbo].[Personas] <span class="sql-statement">ADD  CONSTRAINT</span> [DF_Personas_FechaAlta]  <span class="sql-statement">DEFAULT</span> (<span class="sql-function">getdate</span>()) <span class="sql-statement">FOR</span> [FechaAlta]
        
            <span class="sql-statement">PRINT</span> <span class="sql-string">'La tabla Personas fue creada con éxito'</span>
        <span class="sql-statement">END</span>
        <span class="sql-statement">ELSE</span> 
        <span class="sql-statement">BEGIN</span>
            <span class="sql-statement">PRINT</span> <span class="sql-string">'La tabla Personas ya existe'</span>
        <span class="sql-statement">END </span>

                </pre>
              </div>
              <button type="button" class="btn btn-light">
                <a
                  href="https://dbfiddle.uk/mMLAc5qI"
                  target="_blank"
                  style="text-decoration: none; color: inherit"
                  >Ver en Playground</a
                >
              </button>
            </div>
            <div id="ejemplo6" class="my-4">
              <h4>ALTER TABLE</h4>
              <p>
                Se utiliza para realizar modificaciones en una tabla existente.
                Con ALTER TABLE, puedes agregar, modificar o eliminar columnas,
                así como también establecer restricciones y realizar otras
                modificaciones en la estructura de la tabla.
              </p>
              <p>
                <strong>Ejemplo:</strong>
                Modificó una tabla existente agregando una nueva columna con
                nombre "IdLocalidad"
              </p>
              <p>
                <strong>Nota importante:</strong> En este ejemplo creo la tabla,
                y luego la modifico. Lo hice de esta manera para tener
                disponible la tabla a modificar en el Playground, de lo
                contrario la tabla no existiría en la base de datos
                AdventureWorks
              </p>
              <div class="codigo-fuente">
                <pre>

        <span class="sql-statement">IF</span> <span class="sql-operator">NOT EXISTS</span> (<span class="sql-statement">SELECT TOP</span> 1 1 <span class="sql-statement">FROM</span> <span class="sql-information">INFORMATION_SCHEMA.TABLES</span> <span class="sql-statement">WHERE</span> TABLE_NAME = <span class="sql-string">'Personas'</span> <span class="sql-operator">AND</span> TABLE_SCHEMA = <span class="sql-string">'dbo'</span>) 
        <span class="sql-statement">BEGIN</span>   
            <span class="sql-statement">CREATE TABLE</span> [dbo].[Personas](
                [Id] [int] <span class="sql-statement">IDENTITY</span>(1,1) <span class="sql-operator">NOT NULL,</span>
                [Nombre] [varchar](50) <span class="sql-operator">NOT NULL,</span>
                [Apellido] [varchar](50) <span class="sql-operator">NOT NULL,</span>
                [Documento] [int] <span class="sql-operator">NOT NULL,</span>
                [FechaNacimieto] [datetime] <span class="sql-operator">NULL,</span>
                [Sexo] [varchar](1) <span class="sql-operator">NOT NULL,</span>
                [Estado] [bit] <span class="sql-operator">NOT NULL,</span>
                [FechaAlta] [datetime] <span class="sql-operator">NOT NULL,</span>
                [IdUsuarioAlta] [int] <span class="sql-operator">NOT NULL,</span>
                [FechaModificacion] [datetime] <span class="sql-operator">NULL,</span>
                [IdUsuarioModificacion] [int] <span class="sql-operator">NULL,</span>
                [FechaBaja] [datetime] <span class="sql-operator">NULL,</span>
                [IdUsuarioBaja] [int] <span class="sql-operator">NULL,</span>
            <span class="sql-statement">CONSTRAINT</span> [PK_Personas] <span class="sql-statement">PRIMARY KEY CLUSTERED</span> ([Id] <span class="sql-statement">ASC</span>))

            <span class="sql-statement">ALTER TABLE</span> [dbo].[Personas] <span class="sql-statement">ADD  CONSTRAINT</span> [DF_Personas_Estado]  <span class="sql-statement">DEFAULT</span> ((1)) <span class="sql-statement">FOR</span> [Estado]

            <span class="sql-statement">ALTER TABLE</span> [dbo].[Personas] <span class="sql-statement">ADD  CONSTRAINT</span> [DF_Personas_FechaAlta]  <span class="sql-statement">DEFAULT</span> (<span class="sql-function">getdate</span>()) <span class="sql-statement">FOR</span> [FechaAlta]
        <span class="sql-statement">END</span>
        <span class="sql-statement">ELSE</span> 
        <span class="sql-statement">BEGIN</span>
            <span class="sql-statement">PRINT</span> <span class="sql-string">'La tabla Personas ya existe'</span>
        <span class="sql-statement">END </span>

        <span class="sql-statement">IF</span> <span class="sql-operator">NOT EXISTS</span>(<span class="sql-statement">SELECT</span> 1 <span class="sql-statement">FROM</span> <span class="sql-information">INFORMATION_SCHEMA.COLUMNS</span> <span class="sql-statement">WHERE</span> TABLE_NAME = <span class="sql-string">'Personas'</span> <span class="sql-operator">AND</span> TABLE_SCHEMA = <span class="sql-string">'dbo'</span> <span class="sql-operator">AND</span> COLUMN_NAME = <span class="sql-string">'IdLocalidad'</span>)
        <span class="sql-statement">BEGIN</span>	
            <span class="sql-statement">ALTER TABLE</span> [dbo].[Personas] <span class="sql-statement">ADD</span> [IdLocalidad] [int] <span class="sql-operator">NULL</span>     
            <span class="sql-statement">PRINT</span> <span class="sql-string">'OK: La Columna IdLocalidad fue agregada a la tabla Personas con éxito'</span>
        <span class="sql-statement">END</span>
        <span class="sql-statement">ELSE</span>
        <span class="sql-statement">BEGIN</span>
            <span class="sql-statement">PRINT</span> <span class="sql-string">'ERROR: La tabla Personas ya tiene un columna con nombre IdLocalidad'</span>
        <span class="sql-statement">END</span> 

        <span class="sql-information">-- Solo para mostrar que la columna existe en la Tabla</span>
        <span class="sql-statement">SELECT</span> * <span class="sql-statement">FROM</span> dbo.Personas
                  </pre>
              </div>
              <button type="button" class="btn btn-light">
                <a
                  href="https://dbfiddle.uk/ILeMtciB"
                  target="_blank"
                  style="text-decoration: none; color: inherit"
                  >Ver en Playground</a
                >
              </button>
            </div>
          </div>
        </main>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  </body>
</html>
